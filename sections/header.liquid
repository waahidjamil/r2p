<!-- R2P Header -->
<link rel="stylesheet" href="{{ 'component-list-menu.css' | asset_url }}" media="print" onload="this.media='all'">
<link rel="stylesheet" href="{{ 'component-search.css' | asset_url }}" media="print" onload="this.media='all'">
<link rel="stylesheet" href="{{ 'component-menu-drawer.css' | asset_url }}" media="print" onload="this.media='all'">
<link rel="stylesheet" href="{{ 'component-cart-notification.css' | asset_url }}" media="print" onload="this.media='all'">

{%- if settings.predictive_search_enabled -%}
  <link rel="stylesheet" href="{{ 'component-price.css' | asset_url }}" media="print" onload="this.media='all'">
{%- endif -%}

<style>
  /* --- R2P Announcement Bar --- */
  .r2p-announcement {
    background: var(--r2p-accent);
    color: var(--r2p-black);
    height: var(--r2p-announcement-height);
    display: flex;
    align-items: center;
    overflow: hidden;
    position: relative;
    z-index: 100;
  }

  .r2p-announcement__track {
    display: flex;
    animation: r2p-marquee 25s linear infinite;
    white-space: nowrap;
    will-change: transform;
  }

  .r2p-announcement__item {
    display: inline-flex;
    align-items: center;
    gap: 2rem;
    padding: 0 2rem;
    font-family: var(--font-mono);
    font-size: 0.6875rem;
    font-weight: 500;
    letter-spacing: 0.08em;
    text-transform: uppercase;
    flex-shrink: 0;
  }

  .r2p-announcement__item span {
    display: inline-block;
    width: 4px;
    height: 4px;
    background: var(--r2p-black);
    border-radius: 50%;
    flex-shrink: 0;
  }

  /* --- R2P Header --- */
  .r2p-header {
    position: fixed;
    top: var(--r2p-announcement-height);
    left: 0;
    right: 0;
    z-index: 99;
    height: var(--r2p-header-height);
    display: flex;
    align-items: center;
    padding: 0 var(--r2p-gutter);
    background: rgba(5, 5, 5, 0.6);
    backdrop-filter: blur(12px);
    -webkit-backdrop-filter: blur(12px);
    border-bottom: 1px solid rgba(255, 255, 255, 0.06);
    transition: all var(--duration-transition) var(--ease-out-expo);
  }

  .r2p-header--scrolled {
    top: 0;
    height: 60px;
    background: rgba(5, 5, 5, 0.9);
  }

  .r2p-header__inner {
    display: flex;
    align-items: center;
    justify-content: space-between;
    width: 100%;
    max-width: var(--r2p-page-width);
    margin: 0 auto;
  }

  /* Logo */
  .r2p-header__logo {
    font-family: 'Space Grotesk', sans-serif;
    font-weight: 700;
    font-size: 1.5rem;
    letter-spacing: -0.03em;
    color: var(--r2p-text);
    text-decoration: none;
    flex-shrink: 0;
    transition: color var(--duration-hover) var(--ease-out-expo);
  }

  .r2p-header__logo:hover {
    color: var(--r2p-accent);
  }

  /* Desktop Nav */
  .r2p-header__nav {
    display: none;
    list-style: none;
    gap: 2rem;
    margin: 0;
    padding: 0;
  }

  @media screen and (min-width: 990px) {
    .r2p-header__nav {
      display: flex;
    }
  }

  .r2p-header__nav a {
    font-family: var(--font-body);
    font-size: 0.8125rem;
    font-weight: 500;
    letter-spacing: 0.06em;
    text-transform: uppercase;
    color: var(--r2p-muted);
    text-decoration: none;
    padding: 4px 0;
    position: relative;
    transition: color var(--duration-hover) var(--ease-out-expo);
  }

  .r2p-header__nav a::after {
    content: '';
    position: absolute;
    bottom: 0;
    left: 0;
    width: 0;
    height: 1px;
    background: var(--r2p-accent);
    transition: width var(--duration-transition) var(--ease-out-expo);
  }

  .r2p-header__nav a:hover {
    color: var(--r2p-text);
  }

  .r2p-header__nav a:hover::after {
    width: 100%;
  }

  /* Icons */
  .r2p-header__icons {
    display: flex;
    align-items: center;
    gap: 1.25rem;
  }

  .r2p-header__icon {
    display: flex;
    align-items: center;
    justify-content: center;
    color: var(--r2p-text);
    transition: color var(--duration-hover) var(--ease-out-expo);
    position: relative;
    width: 24px;
    height: 24px;
  }

  .r2p-header__icon:hover {
    color: var(--r2p-accent);
  }

  .r2p-header__icon svg {
    width: 20px;
    height: 20px;
  }

  .r2p-header__cart-count {
    position: absolute;
    top: -6px;
    right: -8px;
    background: var(--r2p-accent);
    color: var(--r2p-black);
    font-family: var(--font-mono);
    font-size: 0.5625rem;
    font-weight: 600;
    width: 16px;
    height: 16px;
    border-radius: 50%;
    display: flex;
    align-items: center;
    justify-content: center;
    line-height: 1;
  }

  /* Mobile menu toggle */
  .r2p-header__menu-toggle {
    display: flex;
    align-items: center;
    justify-content: center;
    background: none;
    border: none;
    color: var(--r2p-text);
    cursor: pointer;
    padding: 4px;
    width: 24px;
    height: 24px;
  }

  @media screen and (min-width: 990px) {
    .r2p-header__menu-toggle {
      display: none;
    }
  }

  .r2p-header__menu-toggle svg {
    width: 20px;
    height: 20px;
  }

  /* Spacer to push content below fixed header */
  .r2p-header-spacer {
    height: calc(var(--r2p-header-height) + var(--r2p-announcement-height));
  }

  /* Mobile Drawer (reuse Dawn's) */
  .r2p-mobile-drawer {
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    z-index: 200;
    visibility: hidden;
    opacity: 0;
    transition: visibility 0s var(--duration-transition), opacity var(--duration-transition) var(--ease-out-expo);
  }

  .r2p-mobile-drawer.is-open {
    visibility: visible;
    opacity: 1;
    transition-delay: 0s;
  }

  .r2p-mobile-drawer__overlay {
    position: absolute;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background: rgba(0, 0, 0, 0.7);
    backdrop-filter: blur(4px);
  }

  .r2p-mobile-drawer__panel {
    position: absolute;
    top: 0;
    left: 0;
    width: 300px;
    max-width: 85vw;
    height: 100%;
    background: var(--r2p-surface);
    border-right: 1px solid var(--r2p-border);
    padding: 24px;
    display: flex;
    flex-direction: column;
    transform: translateX(-100%);
    transition: transform var(--duration-transition) var(--ease-out-expo);
  }

  .r2p-mobile-drawer.is-open .r2p-mobile-drawer__panel {
    transform: translateX(0);
  }

  .r2p-mobile-drawer__close {
    align-self: flex-end;
    background: none;
    border: none;
    color: var(--r2p-text);
    cursor: pointer;
    padding: 4px;
    margin-bottom: 24px;
  }

  .r2p-mobile-drawer__nav {
    list-style: none;
    padding: 0;
    margin: 0;
    display: flex;
    flex-direction: column;
    gap: 4px;
  }

  .r2p-mobile-drawer__nav a {
    display: block;
    font-family: var(--font-body);
    font-size: 1rem;
    font-weight: 500;
    letter-spacing: 0.04em;
    text-transform: uppercase;
    color: var(--r2p-text);
    text-decoration: none;
    padding: 12px 0;
    border-bottom: 1px solid var(--r2p-border);
    transition: color var(--duration-hover) var(--ease-out-expo);
  }

  .r2p-mobile-drawer__nav a:hover {
    color: var(--r2p-accent);
  }

  /* Hide Dawn's default header */
  .header-wrapper:not(.r2p-header-wrapper),
  .section-header > sticky-header:not(.r2p-sticky) {
    display: none;
  }
</style>

<script src="{{ 'cart-notification.js' | asset_url }}" defer="defer"></script>

<!-- Announcement Bar -->
<div class="r2p-announcement" role="marquee" aria-label="Announcements">
  <div class="r2p-announcement__track">
    {%- for i in (1..10) -%}
      <div class="r2p-announcement__item">
        {{ section.settings.announcement_text | default: 'DROP 03 INCOMING — FREE SHIPPING ON ORDERS $100+' }}
        <span aria-hidden="true"></span>
      </div>
    {%- endfor -%}
  </div>
</div>

<!-- Header -->
<header class="r2p-header" role="banner">
  <div class="r2p-header__inner">
    <!-- Mobile menu toggle -->
    <button class="r2p-header__menu-toggle" aria-label="Open menu" onclick="document.getElementById('r2p-mobile-drawer').classList.add('is-open'); document.body.style.overflow='hidden';">
      <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5">
        <line x1="3" y1="6" x2="21" y2="6"/><line x1="3" y1="12" x2="21" y2="12"/><line x1="3" y1="18" x2="21" y2="18"/>
      </svg>
    </button>

    <!-- Logo -->
    {%- if request.page_type == 'index' -%}<h1 class="r2p-header__logo-wrap">{%- endif -%}
      <a href="{{ routes.root_url }}" class="r2p-header__logo">
        {%- if settings.logo != blank -%}
          {%- assign logo_alt = settings.logo.alt | default: shop.name | escape -%}
          {{ settings.logo | image_url: width: 300 | image_tag: alt: logo_alt, width: 120, loading: 'eager', class: 'r2p-header__logo-img' }}
        {%- else -%}
          R2P
        {%- endif -%}
      </a>
    {%- if request.page_type == 'index' -%}</h1>{%- endif -%}

    <!-- Desktop Navigation -->
    <nav aria-label="Main navigation">
      <ul class="r2p-header__nav">
        {%- if section.settings.menu != blank -%}
          {%- for link in section.settings.menu.links -%}
            <li><a href="{{ link.url }}">{{ link.title | escape }}</a></li>
          {%- endfor -%}
        {%- else -%}
          <li><a href="/collections/all">Shop</a></li>
          <li><a href="/collections">Drops</a></li>
          <li><a href="/pages/culture">Culture</a></li>
          <li><a href="/pages/contact">Contact</a></li>
        {%- endif -%}
      </ul>
    </nav>

    <!-- Icons -->
    <div class="r2p-header__icons">
      <!-- Search -->
      <a href="{{ routes.search_url }}" class="r2p-header__icon" aria-label="Search">
        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5">
          <circle cx="11" cy="11" r="7"/><line x1="16.5" y1="16.5" x2="21" y2="21"/>
        </svg>
      </a>

      <!-- Cart -->
      <a href="{{ routes.cart_url }}" class="r2p-header__icon" id="cart-icon-bubble" aria-label="Cart ({{ cart.item_count }} items)">
        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5">
          <path d="M6 2L3 6v14a2 2 0 002 2h14a2 2 0 002-2V6l-3-4z"/><line x1="3" y1="6" x2="21" y2="6"/><path d="M16 10a4 4 0 01-8 0"/>
        </svg>
        {%- if cart != empty -%}
          <span class="r2p-header__cart-count" aria-hidden="true">{{ cart.item_count }}</span>
        {%- endif -%}
      </a>
    </div>
  </div>
</header>

<!-- Mobile Navigation Drawer -->
<div id="r2p-mobile-drawer" class="r2p-mobile-drawer" aria-label="Mobile navigation">
  <div class="r2p-mobile-drawer__overlay" onclick="document.getElementById('r2p-mobile-drawer').classList.remove('is-open'); document.body.style.overflow='';"></div>
  <div class="r2p-mobile-drawer__panel">
    <button class="r2p-mobile-drawer__close" aria-label="Close menu" onclick="document.getElementById('r2p-mobile-drawer').classList.remove('is-open'); document.body.style.overflow='';">
      <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5">
        <line x1="18" y1="6" x2="6" y2="18"/><line x1="6" y1="6" x2="18" y2="18"/>
      </svg>
    </button>
    <nav aria-label="Mobile navigation">
      <ul class="r2p-mobile-drawer__nav">
        {%- if section.settings.menu != blank -%}
          {%- for link in section.settings.menu.links -%}
            <li><a href="{{ link.url }}">{{ link.title | escape }}</a></li>
          {%- endfor -%}
        {%- else -%}
          <li><a href="/collections/all">Shop</a></li>
          <li><a href="/collections">Drops</a></li>
          <li><a href="/pages/culture">Culture</a></li>
          <li><a href="/pages/contact">Contact</a></li>
        {%- endif -%}
      </ul>
    </nav>
  </div>
</div>

<!-- Header spacer -->
<div class="r2p-header-spacer"></div>

{%- if settings.cart_type == "notification" -%}
  {%- render 'cart-notification', color_scheme: section.settings.color_scheme, desktop_menu_type: section.settings.menu_type_desktop -%}
{%- endif -%}

<script type="application/ld+json">
  {
    "@context": "http://schema.org",
    "@type": "Organization",
    "name": {{ shop.name | json }},
    {% if settings.logo %}
      "logo": {{ settings.logo | image_url: width: 500 | prepend: "https:" | json }},
    {% endif %}
    "sameAs": [
      {{ settings.social_twitter_link | json }},
      {{ settings.social_facebook_link | json }},
      {{ settings.social_pinterest_link | json }},
      {{ settings.social_instagram_link | json }},
      {{ settings.social_tiktok_link | json }},
      {{ settings.social_tumblr_link | json }},
      {{ settings.social_snapchat_link | json }},
      {{ settings.social_youtube_link | json }},
      {{ settings.social_vimeo_link | json }}
    ],
    "url": {{ request.origin | append: page.url | json }}
  }
</script>

{%- if request.page_type == 'index' -%}
  {% assign potential_action_target = request.origin | append: routes.search_url | append: "?q={search_term_string}" %}
  <script type="application/ld+json">
    {
      "@context": "http://schema.org",
      "@type": "WebSite",
      "name": {{ shop.name | json }},
      "potentialAction": {
        "@type": "SearchAction",
        "target": {{ potential_action_target | json }},
        "query-input": "required name=search_term_string"
      },
      "url": {{ request.origin | append: page.url | json }}
    }
  </script>
{%- endif -%}

{% schema %}
{
  "name": "R2P Header",
  "class": "section-header r2p-header-wrapper",
  "settings": [
    {
      "type": "text",
      "id": "announcement_text",
      "label": "Announcement text",
      "default": "DROP 03 INCOMING — FREE SHIPPING ON ORDERS $100+"
    },
    {
      "type": "link_list",
      "id": "menu",
      "default": "main-menu",
      "label": "Menu"
    },
    {
      "type": "select",
      "id": "sticky_header_type",
      "options": [
        { "value": "none", "label": "None" },
        { "value": "always", "label": "Always" }
      ],
      "default": "always",
      "label": "Sticky header"
    },
    {
      "type": "color_scheme",
      "id": "color_scheme",
      "label": "Color scheme",
      "default": "scheme-1"
    },
    {
      "type": "range",
      "id": "margin_bottom",
      "min": 0,
      "max": 100,
      "step": 4,
      "unit": "px",
      "label": "Bottom margin",
      "default": 0
    },
    {
      "type": "range",
      "id": "padding_top",
      "min": 0,
      "max": 36,
      "step": 4,
      "unit": "px",
      "label": "Padding top",
      "default": 20
    },
    {
      "type": "range",
      "id": "padding_bottom",
      "min": 0,
      "max": 36,
      "step": 4,
      "unit": "px",
      "label": "Padding bottom",
      "default": 20
    }
  ]
}
{% endschema %}
